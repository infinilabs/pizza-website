<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.79.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Why named Pizza? #  Do you wonder why this project is named Pizza?
To infinity scaling #  Pizza solves the challenge of managing massive data seamlessly. Imagine creating a collection and continuously adding documents, from zero to petabytes, without the need to worry about sharding or reindexing. Scaling your machine becomes effortless, ensuring a smooth, seamless, and painless experience for application developers.
Sharding puzzle #  One of the world&rsquo;s three major challenges: What is the appropriate size for an index shard?"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Why named Pizza"><meta property="og:description" content="Why named Pizza? #  Do you wonder why this project is named Pizza?
To infinity scaling #  Pizza solves the challenge of managing massive data seamlessly. Imagine creating a collection and continuously adding documents, from zero to petabytes, without the need to worry about sharding or reindexing. Scaling your machine becomes effortless, ensuring a smooth, seamless, and painless experience for application developers.
Sharding puzzle #  One of the world&rsquo;s three major challenges: What is the appropriate size for an index shard?"><meta property="og:type" content="article"><meta property="og:url" content="/docs/overview/sharding/"><meta property="article:modified_time" content="2024-08-28T14:58:55+08:00"><title>Why named Pizza | INFINI Pizza</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.aeb4e729664d188f8782b134d28cd51900d8d45b0ffff2d5b2ac899394f551af.css integrity="sha256-rrTnKWZNGI+HgrE00ozVGQDY1FsP//LVsqyJk5T1Ua8="><script defer src=/js/jquery-2.x.min.js></script><script defer src=/js/doc.js></script><link rel=stylesheet crossorigin href=/assets/index-C1z1vz3D.css></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><img src=/img/logo-en.svg alt=Logo></a></h2><div style=margin-bottom:20px id=docsearch></div><div class=heading><select class=version-selector>
<option value>main (latest)</option>
<option value=v0.1.0>v0.1.x</option></select></div><ul><li><input type=checkbox id=section-f3f48e330869cc09ea97a30269be4c02 class=toggle checked>
<label for=section-f3f48e330869cc09ea97a30269be4c02 class="flex justify-between"><a href=/docs/overview/>Overview</a>
<span>▾</span></label><ul><li><a href=/docs/overview/concept/>Concepts</a></li><li><a href=/docs/overview/architecture/>Architecture</a></li><li><a href=/docs/overview/sharding/ class=active>Why named Pizza</a></li><li><a href=/docs/overview/realtime/>How realtime works</a></li></ul></li><li><input type=checkbox id=section-f1b7c1b2e5dd43526e77637c475d35b8 class=toggle>
<label for=section-f1b7c1b2e5dd43526e77637c475d35b8 class="flex justify-between"><a>Getting started</a>
<span>▾</span></label><ul><li><a href=/docs/getting-started/installation/>Installation</a></li><li><a href=/docs/getting-started/configuration/>Configuration</a></li><li><a href=/docs/getting-started/cli/>Pizza CLI</a></li></ul></li><li><input type=checkbox id=section-fb088f8a9be33f7f260ad2b140bb7bdc class=toggle>
<label for=section-fb088f8a9be33f7f260ad2b140bb7bdc class="flex justify-between"><a href=/docs/references/>References</a>
<span>▾</span></label><ul><li><input type=checkbox id=section-02e44f0bf96750fc4746f16db998ed66 class=toggle>
<label for=section-02e44f0bf96750fc4746f16db998ed66 class="flex justify-between"><a href=/docs/references/namespace/>Namespace</a>
<span>▾</span></label><ul><li><a href=/docs/references/namespace/create/>Create a namespace</a></li><li><a href=/docs/references/namespace/delete/>Delete a namespace</a></li></ul></li><li><input type=checkbox id=section-f15027c2778b7b081844da5b47c26928 class=toggle>
<label for=section-f15027c2778b7b081844da5b47c26928 class="flex justify-between"><a href=/docs/references/collection/>Collection</a>
<span>▾</span></label><ul><li><a href=/docs/references/collection/create/>Create a collection</a></li><li><a href=/docs/references/collection/delete/>Delete a collection</a></li><li><a href=/docs/references/collection/get/>Get collection</a></li><li><a href=/docs/references/collection/get_index/>Get collection index</a></li><li><a href=/docs/references/collection/get_rollings/>Get collection rollings</a></li><li><a href=/docs/references/collection/get_schema/>Get collection schema</a></li><li><a href=/docs/references/collection/get_settings/>Get collection settings</a></li></ul></li><li><input type=checkbox id=section-fdb9f1bc0d458c0de14afb266e4e1e5b class=toggle>
<label for=section-fdb9f1bc0d458c0de14afb266e4e1e5b class="flex justify-between"><a href=/docs/references/index/>Index</a>
<span>▾</span></label><ul><li><a href=/docs/references/index/create/>Create an index</a></li><li><a href=/docs/references/index/delete/>Delete an index</a></li><li><a href=/docs/references/index/get/>Get index</a></li><li><a href=/docs/references/index/get_alias/>Get index alias</a></li><li><a href=/docs/references/index/get_mapping/>Get index mapping</a></li><li><a href=/docs/references/index/get_settings/>Get index setting</a></li></ul></li><li><input type=checkbox id=section-eebb290e3504e78bfaf0e003938d0d72 class=toggle>
<label for=section-eebb290e3504e78bfaf0e003938d0d72 class="flex justify-between"><a href=/docs/references/types/>Types</a>
<span>▾</span></label><ul><li><input type=checkbox id=section-6604cf186da4b984c93b54305f8d7768 class=toggle>
<label for=section-6604cf186da4b984c93b54305f8d7768 class="flex justify-between"><a href=/docs/references/types/type_parameter/>Type Parameter</a>
<span>▾</span></label></li></ul></li><li><input type=checkbox id=section-232f0668f3be6ea64e1c220baec34dfc class=toggle>
<label for=section-232f0668f3be6ea64e1c220baec34dfc class="flex justify-between"><a href=/docs/references/document/>Document</a>
<span>▾</span></label><ul><li><a href=/docs/references/document/create/>Create a document</a></li><li><a href=/docs/references/document/fetch/>Fetch a document</a></li><li><a href=/docs/references/document/replace/>Replace a document</a></li><li><a href=/docs/references/document/partial_update/>Partial update a document</a></li><li><a href=/docs/references/document/delete/>Delete a document</a></li><li><a href=/docs/references/document/bulk/>Batch document operation</a></li></ul></li><li><input type=checkbox id=section-271895e92dddd3f684dfff70bbed20a6 class=toggle>
<label for=section-271895e92dddd3f684dfff70bbed20a6 class="flex justify-between"><a href=/docs/references/api_convention/>API conventions</a>
<span>▾</span></label><ul></ul></li><li><input type=checkbox id=section-6b02990358c7382bac3f39043e5fd437 class=toggle>
<label for=section-6b02990358c7382bac3f39043e5fd437 class="flex justify-between"><a href=/docs/references/search/>Search</a>
<span>▾</span></label><ul><li><a href=/docs/references/search/prefix/>Prefix query</a></li><li><a href=/docs/references/search/range/>Range query</a></li><li><a href=/docs/references/search/regexp/>Regexp query</a></li><li><a href=/docs/references/search/term/>Term query</a></li></ul></li><li><input type=checkbox id=section-69a0462c4990a8b0bf6189289fb56e8a class=toggle>
<label for=section-69a0462c4990a8b0bf6189289fb56e8a class="flex justify-between"><a href=/docs/references/aggregation/>Aggregation</a>
<span>▾</span></label><ul><li><a href=/docs/references/aggregation/avg/>Avg aggregation</a></li><li><a href=/docs/references/aggregation/date-histogram/>Date histogram aggregation</a></li><li><a href=/docs/references/aggregation/max/>Max aggregation</a></li><li><a href=/docs/references/aggregation/min/>Min aggregation</a></li><li><a href=/docs/references/aggregation/percentiles/>Percentiles aggregation</a></li><li><a href=/docs/references/aggregation/sum/>Sum aggregation</a></li><li><a href=/docs/references/aggregation/terms/>Terms aggregation</a></li><li><a href=/docs/references/aggregation/value-count/>Value count aggregation</a></li></ul></li><li><a href=/docs/references/configuration/>Configuration</a><ul><li><a href=/docs/references/configuration/region_settings/>Region Settings</a></li></ul></li></ul></li><li><input type=checkbox id=section-4815ea2eab133dd85c2b2a9323d3691d class=toggle>
<label for=section-4815ea2eab133dd85c2b2a9323d3691d class="flex justify-between"><a href=/docs/administration/>Administration</a>
<span>▾</span></label><ul><li><input type=checkbox id=section-abab1b050dc3433070befb160d0b2fa6 class=toggle>
<label for=section-abab1b050dc3433070befb160d0b2fa6 class="flex justify-between"><a>Observability</a>
<span>▾</span></label><ul><li><a href=/docs/administration/observability/health/>Cluster health</a></li><li><a href=/docs/administration/observability/state/>Cluster state</a></li></ul></li></ul></li><li><a href=/docs/release-notes/>Release notes</a><ul></ul></li><li><a href=/docs/community/>Community</a><ul></ul></li></ul><ul><li><a href=/posts/>Blogs
<img height=10px style=vertical-align:middle src=/svg/external-link.svg class=book-icon alt="Open in new window"></a></li><li><a href=https://engine-benchmarks.pizza.rs/ target=_blank rel=noopener>Benchmarks
<img height=10px style=vertical-align:middle src=/svg/external-link.svg class=book-icon alt="Open in new window"></a></li><li><a href=https://github.com/infinilabs/pizza target=_blank rel=noopener>Github
<img height=10px style=vertical-align:middle src=/svg/external-link.svg class=book-icon alt="Open in new window"></a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Why named Pizza</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#why-named-pizza>Why named Pizza?</a><ul><li><a href=#to-infinity-scaling>To infinity scaling</a><ul><li><a href=#sharding-puzzle>Sharding puzzle</a></li></ul></li><li><a href=#pizzas-design>Pizza&rsquo;s design</a><ul><li><a href=#start-with-document-id>Start with document ID</a></li><li><a href=#user-defined-ids>User-defined IDs</a></li><li><a href=#just-like-a-pizza>Just like a Pizza</a></li><li><a href=#more-pizza---rolling>More Pizza - Rolling</a></li><li><a href=#packaged-pizza>Packaged Pizza</a></li><li><a href=#slicing-with-partition>Slicing with partition</a></li><li><a href=#hash-based-routing>Hash based routing</a></li><li><a href=#ultimate-scaling>Ultimate scaling</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=why-named-pizza>Why named Pizza?
<a class=anchor href=#why-named-pizza>#</a></h1><p>Do you wonder why this project is named Pizza?</p><h2 id=to-infinity-scaling>To infinity scaling
<a class=anchor href=#to-infinity-scaling>#</a></h2><p>Pizza solves the challenge of managing massive data seamlessly. Imagine creating a collection and continuously adding documents,
from zero to petabytes, without the need to worry about sharding or reindexing. Scaling your machine becomes effortless,
ensuring a smooth, seamless, and painless experience for application developers.</p><h3 id=sharding-puzzle>Sharding puzzle
<a class=anchor href=#sharding-puzzle>#</a></h3><p>One of the world&rsquo;s three major challenges: What is the appropriate size for an index shard?</p><p><img src=/img/shard-issue.png alt="Yummy Pizza"></p><center>[Sharding Puzzle!]</center><p>Shards are like cars that transport your data, but determining how many shards you need is challenging because the amount of data is unpredictable and could continuously grow.</p><p><img src=/img/shard-sizing.png alt="Yummy Pizza"></p><center>[Sizing Puzzle!]</center><p>Traditional sharding methods have several shortcomings. Currently, distributed system storage partitioning
methods mainly include:</p><ul><li>Range-based partitioning methods require data to have a high dispersion in value ranges.</li><li>Fixed-factor hash partitioning methods, set at database creation, may lead to over-allocation of resources if the partition factor is too large or performance issues if it&rsquo;s too small.</li><li>Consistent hashing algorithms lack adaptability to heterogeneous systems and flexibility in data partitioning, resulting in complex operations and suboptimal resource utilization.</li></ul><p>Is there any other approach?</p><h2 id=pizzas-design>Pizza&rsquo;s design
<a class=anchor href=#pizzas-design>#</a></h2><p>Pizza does things differently!</p><h3 id=start-with-document-id>Start with document ID
<a class=anchor href=#start-with-document-id>#</a></h3><p>Pizza facilitates updates, and it&rsquo;s top-notch. Ensuring efficient updates requires a unique identity for each document.
While accommodating a vast dataset beyond trillions of documents, one can opt for a string-based UUID or utilize a uint64 or
uint128 assigned to each document. However, utilizing a wide-sized primary key may lead to resource wastage, unnecessary compression, or conversion.</p><p>In Pizza, document identification follows a two-dimensional approach. Each document is assigned a unique identity comprising
the rolling ID (<code>rolling_id</code>) and the internal asigned ID (<code>seq_doc_id</code>) within this rolling. These IDs are structured for efficiency, incorporating partition positions
for rapid data localization. Rolling IDs and assigned document IDs increment automatically. Document value ranges vary based on numeric types chosen,
accommodating trillions of documents. User-defined IDs seamlessly map to unique IDs.</p><p>With this design:</p><ul><li>Assigned ID format: <code>[rolling_id], [seq_doc_id]</code>.</li><li>Assigned IDs adopt a composite two-dimensional structure.</li><li>Assigned IDs are compact numeric types designed to support massive datasets.</li><li>Assigned IDs are self-descriptive, include partition positions as routing for rapid data access.</li><li>Rolling ID serves as metadata-level description and does not require persistence with each record.</li><li>The space allocated for sequence assigned IDs is quite compact and compression friendly.</li><li>Assigned ID becomes globally identity is also good fit to support frequently updates.</li></ul><p>Within a single collection, Pizza offers varying document value ranges to accommodate different scale requirements,
For <code>[UInt8, UInt32]</code> the capability estimated as <code>rolling_id</code> ranges from <code>0</code> to <code>255</code> for UInt8 types and <code>seq_doc_id</code> range from <code>0</code> to <code>4,294,967,295</code> for <code>UInt32</code> types.
Which can sustain <code>[0 : 1,095,216,660,225]</code> documents. if we scale <code>rolling_id</code> to use <code>UInt16</code>,
then it will be <code>[0 : 65,535], [0 : 4,294,967,295] = [0 : 281,470,681,677,825]</code>, which means 281 trillions scale, should be good start for any case.</p><p>These capabilities enable Pizza to handle collections of varying sizes, from smaller-scale to trillions of documents, efficiently and smoothly scale on demand.</p><h3 id=user-defined-ids>User-defined IDs
<a class=anchor href=#user-defined-ids>#</a></h3><p>&ldquo;But my IDs was shipped from external database&rdquo;</p><p>That&rsquo;s fair, Pizza handle this simply do map the UUID to an unique assigned document ID.</p><p>For example with this document creation:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>POST /my-collection/_doc/myid
<span style=color:#f92672>{</span>
  <span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;GET /search HTTP/1.1 200 1070000&#34;</span>,
  <span style=color:#e6db74>&#34;org&#34;</span>: <span style=color:#f92672>{</span>
    <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;infini&#34;</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>You will get:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>{</span>
  <span style=color:#e6db74>&#34;_key&#34;</span>: <span style=color:#e6db74>&#34;myid&#34;</span>,
  <span style=color:#e6db74>&#34;_id&#34;</span>: <span style=color:#e6db74>&#34;0,123&#34;</span>,
  <span style=color:#e6db74>&#34;_version&#34;</span>: 1,
  <span style=color:#e6db74>&#34;_namespace&#34;</span>: <span style=color:#e6db74>&#34;default&#34;</span>,
  <span style=color:#e6db74>&#34;_collection&#34;</span>: <span style=color:#e6db74>&#34;my-collection&#34;</span>,
  <span style=color:#e6db74>&#34;result&#34;</span>: <span style=color:#e6db74>&#34;created&#34;</span>,
  ...
<span style=color:#f92672>}</span>
</code></pre></div><p>The <code>_id</code> valued <code>0,123</code> means a unique Pizza document ID was assigned to <code>myid</code> within this collection.</p><p>Instead of passing the UUID throughout the further process, it&rsquo;s common to begin with a search, and you will get a search result.
The document in the search result should contain both <code>_id</code> and <code>_key</code>. pass both of them as the document identity should work.</p><h3 id=just-like-a-pizza>Just like a Pizza
<a class=anchor href=#just-like-a-pizza>#</a></h3><p>As you&rsquo;ve noted, the maximum number of documents in a single rolling is a fixed size of <code>4,294,967,295</code>, typically suitable for smaller use cases.
The fixed capacity of single rolling is not a bug, it is a feature!</p><p>Think of the rolling as the iron plate used for cooking the Pizza, and sending data to the rolling is akin to adding your
delicious ingredients to that iron plate.</p><p>We ingest the data, we enjoy the pizza, just like that!</p><p><img src=/img/rolling-pizza.png alt="Yummy Pizza"></p><center>[Yummy Pizza!]</center><h3 id=more-pizza---rolling>More Pizza - Rolling
<a class=anchor href=#more-pizza---rolling>#</a></h3><p>So you have number of documents beyond <code>4,294,967,295</code>?</p><p>No worries, Let&rsquo;s roll to another rolling, more rolling, more pizza, the party won&rsquo;t stop tonight.</p><p><img src=/img/more-rolling.png alt="More Pizza"></p><center>[More Pizza!]</center><p>When the capacity of a rolling is exceeded, data is automatically switched to the next rolling for continued writing.</p><p>Rollings can grow infinitely to meet ongoing growth requirements.</p><h3 id=packaged-pizza>Packaged Pizza
<a class=anchor href=#packaged-pizza>#</a></h3><p>There are many benefits fo package data like Pizza:</p><ul><li>Each rolling has a fixed size for ease of distribution and physical resource management.</li><li>The number and size of shards are predictable.</li><li>Shards are generated on demand, eliminating the need for advance planning.</li><li>Scalability is infinite, allowing for horizontal expansion.</li><li>Stable and predictable read/write performance.</li></ul><p><img src=/img/packaged-pizza.png alt="More Pizza"></p><center>[Packaged Pizza!]</center><h3 id=slicing-with-partition>Slicing with partition
<a class=anchor href=#slicing-with-partition>#</a></h3><p>Wait, <code>4.2 billion</code> is not a small number, it may choke anyway, so we introduce partitions within rolling, just like we
share slices of pizza to friends.</p><p><img src=/img/pizza-slicing.png alt="More Pizza"></p><center>[Slicing Pizza!]</center><p>A single rolling can be split into a maximum of 256 physical partitions by default (configurable at creation).
A lookup table is used to maintain the relationship between logical partitions and physical shards.</p><p><img src=/img/slice-split-merge.png alt="More Pizza"></p><center>[Slicing Pizza!]</center><p>Physical shards and logical partitions can be dynamically split or merged. In scenarios with low write pressure, all partition data within a single shard is consolidated, appearing as a single data directory physically.</p><h3 id=hash-based-routing>Hash based routing
<a class=anchor href=#hash-based-routing>#</a></h3><p>How about if we have more than one rolling, how do I know which rolling contains these UUID?</p><p>Custom or assigned IDs are hashed based to establish a one-to-one relationship with partitions:</p><p><code>[HASH(KEY) or ID] % 256 = PARTITION_ID</code></p><p><img src=/img/routing-through-partitions.png alt="More Pizza"></p><center>[Routing Slices!]</center><p>The worst case is the request need to revisit same partition across all rollings, but the scope is limited as stepped with <code>4.2b</code>, also we can have UUID mapping cache ahead.</p><p>Always better to use Pizza assigned <code>_id</code> rather the <code>_key</code> for mutation, as <code>_rolling_id</code> is part of <code>_id</code>, so Pizza know which <code>_rolling</code> need to talk without ask.</p><h3 id=ultimate-scaling>Ultimate scaling
<a class=anchor href=#ultimate-scaling>#</a></h3><p>Lastly, we will talk about replica, each shard can have replicas, to scale out for more search throughput.</p><p><img src=/img/sharding.png alt="Sharding Architecture"></p><center>[Sharding Architecture]</center><p>Rolling, Partition, Replica - three dimensions for ultimate scaling.</p><p>The more data you feed in, the more pizza you cook. Enjoy your yummy data!</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/infinilabs/pizza/commit/830e9c08a79e7d49ddad2d5fda7742078898fb34 title="Last modified by Medcl | August 28, 2024" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 28, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/infinilabs/pizza/edit/main/website/content.en/docs/overview/sharding.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div><div class="flex align-center footer">©INFINI.LTD, All Rights Reserved.</div><script async src="https://www.googletagmanager.com/gtag/js?id=G-VV6PGDHH84"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-VV6PGDHH84');</script><script type=text/javascript>var _smartsupp=_smartsupp||{};_smartsupp.key='691ff544d18a237005a011a7290b839d8fe811a4';window.smartsupp||(function(d){var s,c,o=smartsupp=function(){o._.push(arguments)};o._=[];s=d.getElementsByTagName('script')[0];c=d.createElement('script');c.type='text/javascript';c.charset='utf-8';c.async=true;c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);})(document);</script><script type=module crossorigin src=/assets/index-D_gOo737.js></script></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#why-named-pizza>Why named Pizza?</a><ul><li><a href=#to-infinity-scaling>To infinity scaling</a><ul><li><a href=#sharding-puzzle>Sharding puzzle</a></li></ul></li><li><a href=#pizzas-design>Pizza&rsquo;s design</a><ul><li><a href=#start-with-document-id>Start with document ID</a></li><li><a href=#user-defined-ids>User-defined IDs</a></li><li><a href=#just-like-a-pizza>Just like a Pizza</a></li><li><a href=#more-pizza---rolling>More Pizza - Rolling</a></li><li><a href=#packaged-pizza>Packaged Pizza</a></li><li><a href=#slicing-with-partition>Slicing with partition</a></li><li><a href=#hash-based-routing>Hash based routing</a></li><li><a href=#ultimate-scaling>Ultimate scaling</a></li></ul></li></ul></li></ul></nav></aside></main></body></html>